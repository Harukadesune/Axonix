{"remainingRequest":"/Users/haruka/IdeaProjects/Axonix/Foies_vue/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/haruka/IdeaProjects/Axonix/Foies_vue/src/views/Postinfo/index.vue?vue&type=style&index=0&id=5bfde90b&scoped=true&lang=css","dependencies":[{"path":"/Users/haruka/IdeaProjects/Axonix/Foies_vue/src/views/Postinfo/index.vue","mtime":1745308249742},{"path":"/Users/haruka/IdeaProjects/Axonix/Foies_vue/node_modules/css-loader/dist/cjs.js","mtime":1745391002266},{"path":"/Users/haruka/IdeaProjects/Axonix/Foies_vue/node_modules/vue-loader/lib/loaders/stylePostLoader.js","mtime":1745391002124},{"path":"/Users/haruka/IdeaProjects/Axonix/Foies_vue/node_modules/postcss-loader/src/index.js","mtime":1745391002227},{"path":"/Users/haruka/IdeaProjects/Axonix/Foies_vue/node_modules/cache-loader/dist/cjs.js","mtime":1745391003736},{"path":"/Users/haruka/IdeaProjects/Axonix/Foies_vue/node_modules/vue-loader/lib/index.js","mtime":1745391002124}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ci5hcHAtY29udGFpbmVyIHsKICBwYWRkaW5nOiAyMHB4Owp9CgouZWwtdGFibGUgewogIG1hcmdpbi10b3A6IDIwcHg7Cn0KCi5lbC1idXR0b24gewogIG1hcmdpbi1yaWdodDogNXB4Owp9Cgouc2VhcmNoLWZvcm0gewogIG1hcmdpbi1ib3R0b206IDBweDsKfQoKLnJlY29yZC1jb3VudCB7CiAgbWFyZ2luLXRvcDogMjBweDsKICBmb250LXNpemU6IDE0cHg7CiAgY29sb3I6ICM2MDYyNjY7Cn0KCi5hY3Rpb24tcm93IHsKICBtYXJnaW4tYm90dG9tOiAyMHB4Owp9CgouZGlhbG9nLWZvb3RlciB7CiAgdGV4dC1hbGlnbjogcmlnaHQ7Cn0K"},{"version":3,"sources":["index.vue"],"names":[],"mappings":";AAkPA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA","file":"index.vue","sourceRoot":"src/views/Postinfo","sourcesContent":["<template>\n  <div class=\"app-container\">\n    <!-- 搜索表单 -->\n    <el-form :inline=\"true\" :model=\"searchForm\" class=\"search-form\">\n      <el-form-item label=\"帖子标题\">\n        <el-input v-model=\"searchForm.title\" placeholder=\"请输入帖子标题\" clearable />\n      </el-form-item>\n      <el-form-item label=\"用户ID\">\n        <el-input v-model=\"searchForm.userId\" placeholder=\"请输入用户ID\" clearable />\n      </el-form-item>\n      <el-form-item>\n        <el-button type=\"primary\" @click=\"fetchForumPosts\">查询</el-button>\n        <el-button @click=\"resetSearch\">重置</el-button>\n      </el-form-item>\n    </el-form>\n\n    <!-- 操作按钮和记录数显示 -->\n    <el-row class=\"action-row\" type=\"flex\" justify=\"space-between\" align=\"middle\">\n      <el-col :span=\"8\">\n        <el-button type=\"danger\" @click=\"confirmBatchDelete\" :disabled=\"selectedPosts.length === 0\">批量删除</el-button>\n      </el-col>\n      <el-col :span=\"8\" class=\"record-count\" style=\"text-align: right;\">\n        <span>当前共有 {{ totalRecords }} 条记录</span>\n      </el-col>\n    </el-row>\n\n    <!-- 帖子表格 -->\n    <el-table :data=\"posts\" border @selection-change=\"handleSelectionChange\":empty-text=\"'没有数据'\">\n      <el-table-column type=\"selection\" width=\"55\" />\n      <el-table-column prop=\"id\" label=\"ID\" width=\"80\" />\n      <el-table-column prop=\"title\" label=\"标题\" width=\"200\" />\n      <el-table-column prop=\"userId\" label=\"用户ID\" width=\"100\" />\n      <el-table-column prop=\"likes\" label=\"点赞数\" width=\"100\" />\n      <el-table-column prop=\"dislikes\" label=\"点踩数\" width=\"100\" />\n      <el-table-column prop=\"createdAt\" label=\"创建时间\" width=\"180\">\n        <template slot-scope=\"scope\">\n          {{ formatDate(scope.row.createdAt) }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"updatedAt\" label=\"更新时间\" width=\"180\">\n        <template slot-scope=\"scope\">\n          {{ formatDate(scope.row.updatedAt) }}\n        </template>\n      </el-table-column>\n      <el-table-column prop=\"status\" label=\"审核状态\" width=\"120\">\n        <template slot-scope=\"scope\">\n          <el-select v-model=\"scope.row.status\" @change=\"updatePostStatus(scope.row)\" size=\"small\">\n            <el-option label=\"审核中\" :value=\"0\" />\n            <el-option label=\"驳回\" :value=\"1\" />\n            <el-option label=\"异常\" :value=\"2\" />\n            <el-option label=\"已发布\" :value=\"3\" />\n            <el-option label=\"私密\" :value=\"4\" />\n          </el-select>\n        </template>\n      </el-table-column>\n      <el-table-column label=\"操作\" width=\"160\" fixed=\"right\">\n        <template slot-scope=\"scope\">\n          <el-button size=\"mini\" @click=\"handleView(scope.row)\">查看</el-button>\n          <el-button size=\"mini\" type=\"danger\" @click=\"handleDelete(scope.row.id)\">删除</el-button>\n        </template>\n      </el-table-column>\n    </el-table>\n\n    <!-- 查看帖子弹出框 -->\n    <el-dialog :visible.sync=\"dialogVisible\" title=\"帖子详情\" width=\"800px\">\n      <div>\n        <el-form :model=\"currentPost\" label-width=\"100px\">\n          <el-form-item label=\"帖子标题\">\n            <el-input v-model=\"currentPost.title\" readonly />\n          </el-form-item>\n          <el-form-item label=\"用户ID\">\n            <el-input v-model=\"currentPost.userId\" readonly />\n          </el-form-item>\n          <el-form-item label=\"点赞数\">\n            <el-input v-model=\"currentPost.likes\" readonly />\n          </el-form-item>\n          <el-form-item label=\"点踩数\">\n            <el-input v-model=\"currentPost.dislikes\" readonly />\n          </el-form-item>\n          <el-form-item label=\"内容\">\n            <el-input type=\"textarea\" v-model=\"currentPost.content\" rows=\"6\" readonly />\n          </el-form-item>\n        </el-form>\n      </div>\n      <span slot=\"footer\" class=\"dialog-footer\">\n        <el-button @click=\"closeDialog\">关闭</el-button>\n      </span>\n    </el-dialog>\n  </div>\n</template>\n\n<script>\nimport PostinfoAPI from '@/api/postinfo_api';\n\nexport default {\n  data() {\n    return {\n      posts: [],\n      selectedPosts: [],\n      totalRecords: 0,\n      searchForm: {\n        title: '',\n        userId: ''\n      },\n      dialogVisible: false,\n      currentPost: {\n        id: null,\n        title: '',\n        userId: '',\n        likes: 0,\n        dislikes: 0,\n        createdAt: '',\n        updatedAt: '',\n        content: ''\n      }\n    };\n  },\n\n  created() {\n    this.fetchForumPosts();\n  },\n\n  methods: {\n    async fetchForumPosts() {\n      const example = {\n        oredCriteria: [{ criteria: [] }]\n      };\n\n      if (this.searchForm.title) {\n        example.oredCriteria[0].criteria.push({\n          condition: \"title LIKE\",\n          value: `%${this.searchForm.title}%`,\n          singleValue: true\n        });\n      }\n\n      if (this.searchForm.userId) {\n        example.oredCriteria[0].criteria.push({\n          condition: \"user_id =\",\n          value: this.searchForm.userId,\n          singleValue: true\n        });\n      }\n\n      try {\n        const response = await PostinfoAPI.getForumPostsWithBlobs(example);\n        this.posts = response.data;\n\n        const countResponse = await PostinfoAPI.countForumPosts(example);\n        this.totalRecords = countResponse.data;\n      } catch (error) {\n        console.error('获取帖子列表失败', error);\n      }\n    },\n\n    resetSearch() {\n      this.searchForm = { title: '', userId: '' };\n      this.fetchForumPosts();\n    },\n\n    handleSelectionChange(selection) {\n      this.selectedPosts = selection.map(post => post.id);\n    },\n\n    formatDate(date) {\n      const d = new Date(date);\n      return `${d.getFullYear()}/${d.getMonth() + 1}/${d.getDate()} ${d.getHours()}:${d.getMinutes()}:${d.getSeconds()}`;\n    },\n\n    async updatePostStatus(post) {\n      try {\n        await PostinfoAPI.updateForumPost(post);\n        this.$message.success('帖子状态更新成功');\n        post.updatedAt = new Date();\n      } catch (error) {\n        console.error('更新帖子状态失败', error);\n        this.$message.error('更新帖子状态失败');\n      }\n    },\n\n    async handleDelete(postId) {\n      this.$confirm('确定要删除该帖子吗？', '警告', { \n        type: 'warning',\n        cancelButtonText: '取消',\n        confirmButtonText: '确定' })\n        .then(async () => {\n          try {\n            await PostinfoAPI.deleteForumPost(postId);\n            this.$message.success('删除成功');\n            this.fetchForumPosts();\n          } catch (error) {\n            console.error('删除失败', error);\n            this.$message.error('删除失败');\n          }\n        })\n        .catch(() => { });\n    },\n\n    async confirmBatchDelete() {\n      if (this.selectedPosts.length === 0) {\n        this.$message.warning('请选择要删除的帖子');\n        return;\n      }\n\n      this.$confirm('确定要删除选中的帖子吗？', '警告', {\n        type: 'warning',\n        cancelButtonText: '取消',  // 设置取消按钮文本\n        confirmButtonText: '确定'   // 设置确定按钮文本\n      })\n        .then(async () => {\n          try {\n            await Promise.all(this.selectedPosts.map(id => PostinfoAPI.deleteForumPost(id)));\n            this.fetchForumPosts();\n            this.selectedPosts = [];\n            this.$message.success('批量删除成功');\n          } catch (error) {\n            console.error('批量删除失败', error);\n            this.$message.error('批量删除失败');\n          }\n        })\n        .catch(() => { });\n    },\n\n    async handleView(post) {\n      try {\n        const response = await PostinfoAPI.getForumPostDetail(post.id);\n        this.currentPost = response.data;\n        this.dialogVisible = true;\n      } catch (error) {\n        console.error('获取帖子详情失败', error);\n        this.$message.error('获取帖子详情失败');\n      }\n    },\n\n    closeDialog() {\n      this.dialogVisible = false;\n    }\n  }\n};\n</script>\n\n<style scoped>\n.app-container {\n  padding: 20px;\n}\n\n.el-table {\n  margin-top: 20px;\n}\n\n.el-button {\n  margin-right: 5px;\n}\n\n.search-form {\n  margin-bottom: 0px;\n}\n\n.record-count {\n  margin-top: 20px;\n  font-size: 14px;\n  color: #606266;\n}\n\n.action-row {\n  margin-bottom: 20px;\n}\n\n.dialog-footer {\n  text-align: right;\n}\n</style>"]}]}